<html>
  <head>
    <title>BWJS Demo</title>

    <script type="text/javascript" src="./js/Bridgeworks.js"></script>
    
    <!--<link type="text/css" rel="stylesheet" href="css/style.css" />-->
    <!-- jquery stuff -->
    <link type="text/css" rel="stylesheet" href="http://code.jquery.com/ui/1.10.4/themes/smoothness/jquery-ui.css"/>
    <script src="http://code.jquery.com/jquery-1.10.2.js"></script>
    <script src="js/bootstrap.min.js"></script>
    <script src="js/docs.min.js"></script>
    <script src="./js/BwHelper.js"></script>
    <script src="http://code.jquery.com/ui/1.10.4/jquery-ui.js"></script>
    <script src="js/nicEdit.js"></script>


    <link href="http://getbootstrap.com/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Custom styles for this template -->
    <link href="http://getbootstrap.com/examples/dashboard/dashboard.css" rel="stylesheet">
    
    <!-- application scripts -->
    <script type="text/javascript" src="./js/crossbrowser.js"></script>
    <script type="text/javascript" src="./js/editor.js"></script>
    <script type="text/javascript" src="./js/controls.js"></script>
    <!--<link type="text/css" rel="StyleSheet" href="css/bootstrap.min.css"/>-->
      <style type="text/css"></style>
      <style id="holderjs-style" type="text/css"></style>
      <style type="text/css">
          body.modal-open {
              position: fixed;
              top: 0;
              right: 0;
              bottom: 0;
              left: 0;
              overflow-y: scroll;
          }
      </style>
  </head> 
  <body onresize="resize();">
      
      <script type="text/javascript">
          var bridgeworks = null;
          var cube ="objects/Cube.lwo";
          var sphere = "objects/Sphere.lwo";
          var tube = "objects/Tube.lwo";
          var wall = "objects/wall.lwo";
          var currentObj = "Current Object: X";
          var editorOpen = 0;

          var g_labelCount = 0;
          var g_labelName = null;
          var g_countStr = "";
          
          var selectedModel = null;
          
          var capture = false;
          
            function addRecord()
            {
                var nicE = new nicEditors.findEditor('title');
                var title = nicE.getContent();
                //var title = $( "#title" ).val();
                if (title != "") {
                    var update = "\<Set target='Label_" + g_labelName + "' text='" + title + "' show='true'/>";
                    console.debug(update);
                    bridgeworks.updateScene(update);

                    // This flag is checked on dialog close. If true on close
                    // then there are some things to undo.
                    // If we made it this far then there is nothing to undo.
                    adding = false;
                    editorOpen = 0;
                }
                $( "#dialog" ).dialog("close");
            }
            
          function createRecord()
          {

              
              adding = true;
              editorOpen = 1;
              
              var pointWorld = bridgeworks.selector.pointWorld.getValueDirect();
                          
              g_labelCount = g_labelCount + 1;
              g_countStr = g_labelCount.toString();
              
              g_labelName = "L-" + g_countStr;
              
              var xml = loadXMLFile("bwcontent/label.xml");
              
              var name = xml.getElementsByTagName("Model")[0].attributes[0];
              name.value = g_labelName;

              var pos = xml.getElementsByTagName("position")[0];
              pos.attributes["x"].value = pointWorld.x.toString();
              pos.attributes["y"].value = pointWorld.y.toString();
              pos.attributes["z"].value = pointWorld.z.toString();
              
              var label = xml.getElementsByTagName("Label")[0];
              label.attributes["name"].value = "Label_" + name.value;
              label.attributes["parent"].value = name.value;
              
              name = xml.getElementsByTagName("Group")[0].attributes[0];
              name.value = "Group_" + g_labelName;
              
              
              var xstr = (new XMLSerializer()).serializeToString(xml);
              console.debug(xstr);
              bridgeworks.updateScene(xstr);
              $( "#dialog" ).dialog("open");
              //addRecord();
          }
          
          
          // This function makes it so that mouse interaction with the scene
          // continues when the cursor moves out of the Bridgeworks frame.
          function handleDocMove(event)
          {
              if (capture) bridgeworks.handleEvent(event);
          }
          function setObject(Object)
          {
              var p = document.getElementById('Current_Object');
              switch(Object)
              {
                  case 0:
                      currentObj = "Current Object: Cube";
                      p.innerHTML = currentObj;
                      break;

                  case 1:
                      currentObj = "Current Object: Sphere";
                      p.innerHTML = currentObj;
                      break;

                  case 2:
                      currentObj = "Current Object: Tube";
                      p.innerHTML = currentObj;
                      break;

                  case 3:
                      currentObj = "Current Object: Wall";
                      p.innerHTML = currentObj;
                      break;
                  case 4:
                      currentObj = "Current Object: Grid";
                      p.innerHTML = currentObj;

              }
          }
          function setScene(Scene) {
              var P = document.getElementById('Current_Scene');
              switch(Scene){
                  case 1:
                      P.innerHTML = "Current Slide: 1";
                      break;
                  case 2:
                      P.innerHTML = "Current Slide: 2";
                      break;
                  case 3:
                      P.innerHTML = "Current Slide: 3";
                      break;
                  case 4:
                      P.innerHTML = "Current Slide: 4";
                      break;
                  case 5:
                      P.innerHTML = "Current Slide: 5";
                      break;
              }
          }
          //Mock Up of How Search would work
          function Search()
          {
              var Search = $( "#Search" ).val();
              var cmd = "\<Locate target='" + Search + "'/>";
              bridgeworks.updateScene(cmd);
              console.debug(cmd);
          }
          function handleEvent(e)
          {
              bridgeworks.handleEvent(e);

              switch(e.type) {
                case "mousedown": {
                    capture = true;

                }
                    break;
                case "mouseup":
                    capture = false;
                    break;
                case "click": {
                    //Dishing out the event client x and y cordinates of the mouse for testing purposes
                    if (!e.metaKey && !e.ctrlKey) {
                        selectedModel = bridgeworks.selector.selections.models[0];
                        if (selectedModel) {
                            var pos = selectedModel.position.getValueDirect();
                            $("#positionX").spinner("value", pos.x);
                            $("#positionY").spinner("value", pos.y);
                            $("#positionZ").spinner("value", pos.z);
                            
                            var rot = selectedModel.rotation.getValueDirect();
                            $("#rotationX").spinner("value", rot.x);
                            $("#rotationY").spinner("value", rot.y);
                            $("#rotationZ").spinner("value", rot.z);
                            
                            $("#scale").spinner("value", selectedModel.scale.getValueDirect().x);
                            $('#objectname').val(selectedModel.name.getValueDirect().join(""))
                            
                        }
                    }
                    capture = false;
                }
                break;
                case "dblclick":
                {
                    var name = selectedModel.name.getValueDirect().join("");
                    var pointWorld = bridgeworks.selector.pointWorld.getValueDirect();
                    var cmd = "";
                    if (e.metaKey || e.ctrlKey) {
                        cmd = "\<AutoInterpolate target='" + name + "'>";
                        cmd += "\<position x='" + pointWorld.x + "' y='" + pointWorld.y + "' z='" + pointWorld.z + "'/>"
                        cmd += "\</AutoInterpolate>";
                    }
                    else {
                        cmd = "\<Locate target='" + name + "'/>";
                    }
                    console.debug(cmd);
                    bridgeworks.updateScene(cmd);

                    var CUBE = name.search("Cube");
                    var SPHERE = name.search("Sphere");
                    var TUBE = name.search("Tube");
                    var WALL = name.search("wall");

                    if(CUBE != -1){
                            setObject(0);
                    }
                    else if(SPHERE != -1){
                            setObject(1);
                    }
                    else if(TUBE != -1){
                            setObject(2);
                    }
                    else if(WALL != -1){
                            setObject(3);
                    }
                    else if(name.search("Grid" != -1)){
                            setObject(4);
                    }
                }
                break;
              }
              
          }

          function handleKey(e)
          {
            if(editorOpen == 0) {
                switch (e.keyCode) {
                    case 'C'.charCodeAt(0):
                    {
                        if (e.metaKey || e.ctrlKey) {
                            e.preventDefault();
                            copy();
                            copy();
                        }      // c
                    }
                        break;
                    case 'V'.charCodeAt(0):
                    {      // v
                        if (e.metaKey || e.ctrlKey) {
                            if (document.activeElement.id != 'url') {
                                e.preventDefault();
                                paste();
                            }
                        }
                    }
                        break;
                    case 'X'.charCodeAt(0):
                    {      // x
                        if (e.metaKey || e.ctrlKey) {
                            e.preventDefault();
                            cut();
                        }
                    }
                        break;

                }
            }
          }
          
      </script>

            <img id="BackgroundImage" style="position: absolute;" src="bwcontent/images/white.png"/>

      <div class="modal fade" id="myModal">
          <div class="modal-dialog">
              <div class="modal-content">
                  <div class="modal-header">
                      <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                      <h4 class="modal-title">Note #{{notes.length + 1}}</h4>
                  </div>
                  <div class="modal-body">
                      <textarea class="form-control" rows="3" placeholder="Enter Note"></textarea>
                  </div>
                  <div class="modal-footer">
                      <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                      <button type="button" class="btn btn-primary">Save changes</button>
                  </div>
              </div><!-- /.modal-content -->
          </div><!-- /.modal-dialog -->
      </div><!-- /.modal -->
      <div class="navbar navbar-inverse navbar-default navbar-fixed-top" role="navigation">
          <div class="container-fluid">
              <div class="navbar-header">
                  <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                      <span class="sr-only">Toggle navigation</span>
                      <span class="icon-bar"></span>
                      <span class="icon-bar"></span>
                      <span class="icon-bar"></span>
                  </button>
                  <a class="navbar-brand" href="http://www.github.com/kmcurry/3scape">3Scape</a>
              </div>
              <div class="collapse navbar-collapse">
                  <ul class="nav navbar-nav">
                     <!-- <li class="dropdown">
                          <a href="#" class="dropdown-toggle" data-toggle="dropdown">File<b class="caret"></b></a>
                          <ul class="dropdown-menu">
                              <li><a href="#">Action</a></li>
                              <li><a href="#">Another action</a></li>
                              <li><a href="#">Something else here</a></li>
                              <li class="divider"></li>
                              <li class="dropdown-header">Nav header</li>
                              <li><a href="#">Separated link</a></li>
                              <li><a href="#">One more separated link</a></li>
                          </ul>
                      </li>
                      <li class="dropdown">
                          <a href="#" class="dropdown-toggle" data-toggle="dropdown">Edit<b class="caret"></b></a>
                          <ul class="dropdown-menu">
                              <li><a href="#">Action</a></li>
                              <li><a href="#">Another action</a></li>
                              <li><a href="#">Something else here</a></li>
                              <li class="divider"></li>
                              <li class="dropdown-header">Nav header</li>
                              <li><a href="#">Separated link</a></li>
                              <li><a href="#">One more separated link</a></li>
                          </ul>
                      </li>
                      <li class="dropdown">
                          <a href="#" class="dropdown-toggle" data-toggle="dropdown">View<b class="caret"></b></a>
                          <ul class="dropdown-menu">
                              <li><a href="#">Action</a></li>
                              <li><a href="#">Another action</a></li>
                              <li><a href="#">Something else here</a></li>
                              <li class="divider"></li>
                              <li class="dropdown-header">Nav header</li>
                              <li><a href="#">Separated link</a></li>
                              <li><a href="#">One more separated link</a></li>
                          </ul>
                      </li>-->
                      <li class="dropdown">
                          <a href="#" class="dropdown-toggle" data-toggle="dropdown">New Object<b class="caret"></b></a>
                          <ul class="dropdown-menu">
                              <li><a onclick="load(cube),setObject(0);">Cube</a></li>
                              <li><a onclick="load(sphere),setObject(1);">Sphere</a></li>
                              <li><a onclick="load(tube),setObject(2);">Tube</a></li>
                              <li><a onclick="load(wall),setObject(3);">Wall</a></li>
                              <li class="divider"></li>
                              <li class="dropdown-header">Nav header</li>
                              <li><a href="#">Separated link</a></li>
                              <li><a href="#">One more separated link</a></li>
                          </ul>
                      </li>
                      <li><p class="navbar-text" id="Current_Object">Current Object: X</p></li>
                      <li>
                              <div class="dropdown">
                              <button type="button" class="btn btn-default navbar-btn" id="dLabel" role="button" onclick="createRecord();" > <!--data-toggle="dropdown" data-target="#" href="/page.html" onclick="createRecord();"-->
                                  Add Label
                              </button>
                          </div>
                      </li>
                      <li>
                        <div class="navbar-form" style="width:200px;">
                          <div class="input-group">
                            <input type="text" class="form-control" id="Search">
                            <span class="input-group-btn">
                              <button class="btn btn-default" type="button" onclick="Search();"><span class="glyphicon glyphicon-search" style="font-size:1.4em;"></span></button>
                            </span>
                          </div><!-- /input-group -->
                        </div>
                      </li>
                  </ul>
                  <ul class="nav navbar-nav navbar-right">
                      <li><p class="navbar-text" id="Current_Scene">Current Slide: X</p></li>
                      <li class="dropdown">
                          <a href="#" class="dropdown-toggle" data-toggle="dropdown">Presentation Notes<b class="caret"></b></a>
                          <ul class="dropdown-menu">
                              <li><a id="ex1" href="#">Note1</a></li>
                              <li><a id="ex2" href="#">Note2</a></li>
                              <li><a id="ex3" href="#">Note3</a></li>
                              <li class="divider"></li>
                              <li><a href="#" data-toggle="modal" data-target="#myModal">New Note</a></li>
                          </ul>
                      </li>
                  </ul>
              </div><!--/.nav-collapse -->
          </div>
      </div>

          <div class="row">
              <!-- Left side slide preview space -->
              <div class="col-sm-3 col-md-2 sidebar">
                  <span class="glyphicon glyphicon-play" style="font-size:1.4em"></span>
                  <span class="glyphicon glyphicon-pause" style="font-size:1.4em"></span>
                  <span class="glyphicon glyphicon-stop" style="font-size:1.4em"></span>
                  <ul class="nav nav-tabs">
                      <li class="active"><a href="#slides" data-toggle="tab">Slides</a></li>
                      <li><a href="#animate" data-toggle="tab">Animate</a></li>
                  </ul>
                  <div class="tab-content">
                      <div class="tab-pane active" id="slides">
                          <ul class="nav nav-sidebar">
                              <li><a href="javascript:bridgeworks.contentDir+='/Egypt/';bridgeworks.updateScene('Egypt-Models.xml'), setScene(1);">Slide 1</a></li>
                              <li><a href="javascript:bridgeworks.updateScene('Slide2.xml'), setScene(2);">Slide 2</a></li>
                              <li><a href="javascript:bridgeworks.updateScene('Slide3.xml'), setScene(3);">Slide 3</a></li>
                              <li><a href="javascript:bridgeworks.updateScene('Slide4.xml'), setScene(4);">Slide 4</a></li>
                              <li><a href="javascript:bridgeworks.updateScene('Slide5.xml'), setScene(5);">Slide 5</a></li>
                          </ul>
                      </div>
                      <div class="tab-pane" id="animate">
                          Goodbye!
                          <ul class="nav nav-sidebar">
                              <li><a href="">Nav item</a></li>
                              <li><a href="">Nav item again</a></li>
                              <li><a href="">One more nav</a></li>
                              <li><a href="">Another nav item</a></li>
                              <li><a href="">More navigation</a></li>
                          </ul>
                          <ul class="nav nav-sidebar">
                              <li><a href="">Nav item again</a></li>
                              <li><a href="">One more nav</a></li>
                              <li><a href="">Another nav item</a></li>
                          </ul>
                      </div>
                  </div>
              </div>
              <div class="col-sm-12" style="height:100%" id="BwContainer" ondblclick="handleEvent(event);" onclick="handleEvent(event);" onmousedown="handleEvent(event);" onmouseup="handleEvent(event);" onmousemove="handleEvent(event);">
                  <canvas id="Canvas">
                  </canvas>
              </div>
          </div>

      <div id="dialog" title="Please enter your description for this item below">
          <form method="post"> <!--id="my-form" enctype="multipart/form-data" -->
              <textarea name="title" id="title" style="width:100%"></textarea>
              <!-- <input type="text" id="title">-->
              <p><input type="button" value="Submit" onclick="addRecord()"></p>
          </form>
      </div>


    
    <!--<video controls="controls" src="http://localhost/bwjs/bwcontent/images/quake.mpg">
    Your browser does not support the video tag.
    </video>-->
        
        <script type="text/javascript">
        document.onreadystatechange = function () {
            if (document.readyState == "complete") {
                //This is changing the background of the slides navbar to active and non active to give it the selected effect.
                    $('.nav li a').click(function(e) {

                        $('.nav li').removeClass('active');

                        var $parent = $(this).parent();
                        if (!$parent.hasClass('active')) {
                            $parent.addClass('active');
                        }
                    });
                bridgeworks = init("grid-100.xml", document.getElementById("BwContainer"));
                //bridgeworks = init("Egypt/Egypt.xml", document.getElementById("BwContainer"));

                //listLibrary();
                
                
                $('html').bind('keypress', function(e)
                {
                   if(e.keyCode == 13)
                   {
                       if ($("#dialog").dialog( "isOpen" )===true) {
                           addRecord();
                       }
                       return false;
                   }
                });

                
                $( "#dialog" ).dialog({
                    autoOpen: false,
                    modal: true
                });
            
                $( "#dialog" ).dialog({ show: { effect: "blind", duration: 200 } });
            
                $( "#dialog" ).dialog({ hide: { effect: "blind", duration: 200 } });

                $( "#dialog").dialog({open: function(event,ui) {

                    new nicEditor({
                        fullPanel : true,
                        iconsPath : 'nicEditorIcons.gif'
                    }).panelInstance('title');
                }
                });
          
                $( "#dialog" ).dialog({
                  close: function( event, ui ) {
                      if (adding) {
                          // if in the middle of adding and closed w/o submitting
                          bridgeworks.updateScene("\<Remove target='" + "Group_L-" + g_countStr + "'/>");
                      }
                      adding = false;
                      editorOpen = 0;
                  }
                });
                
                
                $(".btn-slide").click(function(){
                		$("#ControlPanel").slideToggle("medium");
                		$(this).toggleClass("active"); return false;
                	});
                
                window.onkeydown = handleKey;
                //window.onkeyup = handleKey;
                
                $('.ui-spinner-button').click(function() { $(this).siblings('input').change(); });
                
                
            }
        }
        </script>
      <script type="text/javascript">
          $(function () {
              var showPopover = function () {
                          $(this).popover('show');
                      }
                      , hidePopover = function () {
                          $(this).popover('hide');
                      };
              $('#ex1').popover({
                  content: 'An Example1 popover',
                  trigger: 'hover',
                  placement:'left'
              })
              $('#ex2').popover({
                  content: 'An Example2 popover',
                  trigger: 'hover',
                  placement:'left'
              })

              $('#ex3').popover({
                  content: 'An Example3 popover',
                  trigger: 'hover',
                  placement:'left'
              })

          });
          $('.dropdown-menu').find('form').click(function (e) {
              e.stopPropagation();
          });
      </script>

  </body>
</html>
